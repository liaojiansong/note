## redis 须知
### 缓存的几种事故
前提:请求量巨大
#### 缓存穿透
##### 定义
访问一个根本不存在的key(例如id为负数),这个时候请求就会跑到数据库中,造成数据库压力
##### 解决方案
1. 采用布隆过滤器
2. 即使是空值,也一样写进缓存中,并设置一个较短的过期时间
3. 判断key的合理性,例如负数一律打死

#### 缓存雪崩
##### 定义
大量的key在同一时间内集体失效又或者说缓存系统突然宕机,请求集中跑到数据库中. 
##### 解决方案
1. 避免key过期时间过于集中,交错散布
2. 采用缓存集群系统加哨兵模式,迅速换掉挂了的机器
3. 采用持久化,尽快从磁盘中回复数据
4. 限流处理,进行服务降级


#### 缓存击穿
##### 定义
某一个热点key突然间失效,导致大量请求跑到数据库中
##### 解决方案
1. 将热点数据设置为永不过期,编码管控
2. 利用SETNX互斥锁(SETNX 是SET if Not Exists的简写)



### SETNX
SETNX 是SET if Not Exists的简写,判断一个key如果不存在,就为这个key 设定一个值.假如key已经存在,将无法再给这个key设定值
#### 作用
可以利用SETNX做一个互斥锁,只有当你获得这个锁的时候才能去更新缓存,而其他的请求只能等待. 不过要注意死锁的问题(利用时间判断解决如:时间戳-占用秒数)

